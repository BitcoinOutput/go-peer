# HLS

> Hidden Lake Service

## Description

The HLS is the core of the anonymous network, representing API functions for 
interacting with the network. HLS is based on the fifth^ stage of anonymity and represents the implementation of an abstract anonymous network based on queues.

## Cryptographic algorithms

1. AES-256-CTR (Data encryption)
2. RSA-4096-OAEP (Key encryption)
3. RSA-4096-PSS (Hash signing)
4. SHA-256 (Data hashing)
5. HMAC-SHA-256 (Network hashing)
6. PoW-20 (Hash proof)

## Config structure

```
"network"      A network key created to encapsulate connections
"address.tcp"  Connection address for anonymity network, may be void
"address.http" Connection address for API functions
"services"     Map with redirects requests from network to services
"connections"  Connection addresses of the another nodes in network
"friends"      Friend addresses for send or receive messages over network
```

```json
{
	"network": "hls-network-key",
	"address": {
		"tcp": "localhost:9571",
		"http": "localhost:9572"
	},
	"services": {
		"hidden-default-service": "localhost:8080"
	},
	"connections": [
		"localhost:8571"
	],
	"friends": {
		"alias-name": "Pub(go-peer/rsa){30818902818100C709DA63096CEDBA0DD6B5DD9465B412268C00509757A8EBD9096E17BEEC17C25A3A8F246E1591554CD214F4B27254EFA811F8BE441A03B37B3C8B390484C74C2294A4C895AA925D723E0065A877D4502CC010996863821E7348348E4E96CDD4CB7A852B2E2853C8FDEE556C4F89F6C3295EAC00DAEE86DD94E25F9703F368C70203010001}"
	}
}
```

## Request structure in HLS for internal services

```
Need encode this json to hex format
and put result to "hex_data" HLS API

"body" is base64 string
```

```json
{
	"method":"GET",
	"host":"hidden-default-service",
	"path":"/",
	"head":{
		"Accept": "application/json"
	},
	"body":"aGVsbG8sIHdvcmxkIQ=="
}
```

## Response structure from HLS API

```
"result" is string
"return" is int; 1 = success
```

```json
{
	"result":"go-peer/hidden-lake-service",
	"return":1
}
```

## HLS API

```
1. GET/POST/DELETE /api/config/connects
2. GET/POST/DELETE /api/config/friends
3. GET/DELETE      /api/network/online
4. POST/PUT        /api/network/push
5. GET             /api/node/pubkey
```

### 1. /api/config/connects

#### 1.1. GET Request

```bash
curl -i -X GET -H 'Accept: application/json' http://localhost:7572/api/config/connects
```

#### 1.1. GET Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:19:00 GMT
Content-Length: 39
```

```json
{"result":"localhost:9571,localhost:8888","return":1}
```

#### 1.2. POST Request

```bash
curl -i -X POST -H 'Accept: application/json' http://localhost:7572/api/config/connects --data '{"connect":"localhost:8888"}'
```

#### 1.2. POST Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:20:10 GMT
Content-Length: 52
```

```json
{"result":"success: update connections","return":1}
```

#### 1.3. DELETE Request

```bash
curl -i -X DELETE -H 'Accept: application/json' http://localhost:7572/api/config/connects --data '{"connect":"localhost:8888"}'
```

#### 1.3. DELETE Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:20:57 GMT
Content-Length: 51
```

```json
{"result":"success: delete connection","return":1}
```

### 2. /api/config/friends

#### 2.1. GET Request

```bash
curl -i -X GET -H 'Accept: application/json' http://localhost:9572/api/config/friends
```

#### 2.1. GET Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 08:57:24 GMT
Transfer-Encoding: chunked
```

```json
{"result":"Pub(go-peer/rsa){3082020A0282020100E5B249D1547C5CD9A340CA8DB7DCB789657BAFD39FFA09351DF818CE99CED41451C6D5C7FD87C1CC027C6FC51A8C160DFE5029DA19F02D6E3A237995D0C64FFDEE8423A201663DEDA4574949C76EDE313EE8CC81C7451D602B133936CC045AA73218B2F6359777892A20C4041CAAB279B8718805A56E4C44CEC3BB7B084C1C8EF009E0BAD0F391B4204F96698526CF386B05F0B76CFE6FE278B023C5495D5E728500CFFCF5075DB6AC5214B97D7D14CECAB21E1F79E8AF844999760A040173B0D2DADDC0013A45C3423F127459E0FB70380E8469A7069C31DCD18760E2F0481F1CC2437BEFB801C394FE5D5AC1F985D52D44B980A9E64E46FDA1C3F2A739D2C473057506718EE9903C7E1FD584EE2261593C64543417846B3137098EEBE638AB54149A4EE2839A1DF243B593A3A952A2760885F62986E951C87FEBD99D47FBC7ECF6369DC94663A241ED72BBDB5AD86981ECE2862BE7B32C550A9D9FA141438BA3BA05EF68E52B18F9167CA3D10067CA350D2266385A8470927FAC05A3EBB8D0CB0C9F6430D205F933693478377F892506EAEA2ADE6A9DD736BC54583FF308068DB3B1A37B3ADA22695B27564A4822BDC143381617BCCD0CB7EFB21E1ACA4669B9A72AC3CAC6305407AA16DD50FA8AFEBA680D979242C521A2F9989008FAF6F691A55C34CF0988E4201536F95CF6C92E388278E1F70837C6CCFCC7ACD35272410203010001},Pub(go-peer/rsa){3082020A0282020100C71D5265F2CF14041E3E966B13E652ED8A87913E6907FB16FCE698F876B5AE7544FB337FB246DD20FEEFDFAE823476F1B6CC01A0F5C25D3F7A0FD17BAF2EF4193883FB55E6945B51FC6E17B625391F99EAE223FB4992BA5FE83C000BC44FEF67F78A33A7BDB1891E16EBDF6C0C161709242B5EF275E9B0DACDC5FA6BF7884C942FB9A2B8C4C04265DD209306DE805D5232A68D4E2B124699BB37C19C1EB493938E5CED4E717AD030440337423E306C80AA9AE6F5B63D03D5EC6B7F708E9CE6B3716820A9B643D6F7C318F18CFB28AB20153A6AD43E81CC0BB9758670D9F592A3D9713565BC26767D8FAB3BC2D33847F34DD0BE1F3C53F4873C5153E761B7AE346CABB52A9692618D3AC7282C90B294A3129B91B40FE04CB481922EC3C6C31ED068A2654CD1ACFF5584515204ADCB84CB5ACD3DA07DCBCABE45BD4CBC3D55FE41FF9FAB41ECF948E43C1FE9A8253CD1AEE30900216C0A78ED0AB3C2DEB0852003C5155C57C5847374248430A8D462908B0B5E5E03AD597C44EB4ECDE82B1B62DA29A0792E890F6B6CE1672285C8D5D16DC8E0DF3D0B6110A9CC7D1BCF63E6B83C4E976A088DDDACC7FD711F95F568D4E8ED96D3E17C9E48DCA363D6F024507E423326936090E3A4B9865DF6AB577BC4EC45CC8C9BA4E80E9B9D8BF3A6C796555582016148C8C2D85FBD5284E1013F7451FC52ABF70942CB7D7DE8F75D97522FA50203010001}","return":1}
```

#### 2.2. POST Request

```bash
curl -i -X POST -H 'Accept: application/json' http://localhost:7572/api/config/friends --data '{"friend":"Pub(go-peer/rsa){30818902818100B662B1E9B64BE02E34A23F656D3A9A42C3F7C723580187768CADD92CC4B1A8D87BF1F922B6FF1E8715F6C4897B6ED834BC2CBE1E0988DFD93E99E391B3853F5455E0CB292F2C5801357872D282888FB56A02FA86EB38A650F8569FB2FDCB93A0C7E776CD62BF030B502FC680FCCDEE11D3BB8D0D6B8FE7367D10B0B3EFBBE0210203010001}"}'
```

#### 2.2. POST Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:02:05 GMT
Content-Length: 48
```

```json
{"result":"success: update friends","return":1}
```

#### 2.3. DELETE Request

```bash
curl -i -X DELETE -H 'Accept: application/json' http://localhost:7572/api/config/friends --data '{"friend":"Pub(go-peer/rsa){30818902818100B662B1E9B64BE02E34A23F656D3A9A42C3F7C723580187768CADD92CC4B1A8D87BF1F922B6FF1E8715F6C4897B6ED834BC2CBE1E0988DFD93E99E391B3853F5455E0CB292F2C5801357872D282888FB56A02FA86EB38A650F8569FB2FDCB93A0C7E776CD62BF030B502FC680FCCDEE11D3BB8D0D6B8FE7367D10B0B3EFBBE0210203010001}"}'
```

#### 2.3. DELETE Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:17:36 GMT
Content-Length: 47
```

```json
{"result":"success: delete friend","return":1}
```

### 3. /api/network/online

#### 3.1. GET Request

```bash
curl -i -X GET -H 'Accept: application/json' http://localhost:9572/api/network/online
```

#### 3.1. GET Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Fri, 07 Oct 2022 12:09:53 GMT
Content-Length: 55
```

```json
{"result":"127.0.0.1:58708,127.0.0.1:58710","return":1}
```

#### 3.2. DELETE Request

```bash
curl -i -X DELETE -H 'Accept: application/json' http://localhost:9572/api/network/online --data '{"connect":"localhost:8888"}'
```

#### 3.2. DELETE Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:20:57 GMT
Content-Length: 58
```

```json
{"result":"success: delete online connection","return":1}
```

### 4. /api/network/push

#### Prefix script

```bash
#!/bin/bash

str2hex() {
    local str=${1:-""}
    local fmt="%02X"
    local chr
    local -i i
    for i in `seq 0 $((${#str}-1))`; do
        chr=${str:i:1}
        printf "${fmt}" "'${chr}"
    done
}

JSON_DATA='{
        "method":"POST",
        "host":"hidden-echo-service",
        "path":"/echo",
        "head":{
            "Accept": "application/json"
        },
        "body":"aGVsbG8sIHdvcmxkIQ=="
}';

# POST = request with response from service
# PUT  = broadcast without response from service
PUSH_FORMAT="{
        \"receiver\":\"Pub(go-peer/rsa){3082020A0282020100E5B249D1547C5CD9A340CA8DB7DCB789657BAFD39FFA09351DF818CE99CED41451C6D5C7FD87C1CC027C6FC51A8C160DFE5029DA19F02D6E3A237995D0C64FFDEE8423A201663DEDA4574949C76EDE313EE8CC81C7451D602B133936CC045AA73218B2F6359777892A20C4041CAAB279B8718805A56E4C44CEC3BB7B084C1C8EF009E0BAD0F391B4204F96698526CF386B05F0B76CFE6FE278B023C5495D5E728500CFFCF5075DB6AC5214B97D7D14CECAB21E1F79E8AF844999760A040173B0D2DADDC0013A45C3423F127459E0FB70380E8469A7069C31DCD18760E2F0481F1CC2437BEFB801C394FE5D5AC1F985D52D44B980A9E64E46FDA1C3F2A739D2C473057506718EE9903C7E1FD584EE2261593C64543417846B3137098EEBE638AB54149A4EE2839A1DF243B593A3A952A2760885F62986E951C87FEBD99D47FBC7ECF6369DC94663A241ED72BBDB5AD86981ECE2862BE7B32C550A9D9FA141438BA3BA05EF68E52B18F9167CA3D10067CA350D2266385A8470927FAC05A3EBB8D0CB0C9F6430D205F933693478377F892506EAEA2ADE6A9DD736BC54583FF308068DB3B1A37B3ADA22695B27564A4822BDC143381617BCCD0CB7EFB21E1ACA4669B9A72AC3CAC6305407AA16DD50FA8AFEBA680D979242C521A2F9989008FAF6F691A55C34CF0988E4201536F95CF6C92E388278E1F70837C6CCFCC7ACD35272410203010001}\",
        \"hex_data\":\"$(str2hex "$JSON_DATA")\"
}";
```

#### 4.1. POST Request

```bash
curl -i -X POST -H 'Accept: application/json' http://localhost:7572/api/network/push --data "${PUSH_FORMAT}"
```

#### 4.1. POST Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Fri, 07 Oct 2022 12:18:34 GMT
Content-Length: 97
```

```json
{"result":"7b226563686f223a2268656c6c6f2c20776f726c6421222c2272657475726e223a317d0a","return":1}
```

#### 4.2. PUT Request

```bash
curl -i -X PUT -H 'Accept: application/json' http://localhost:7572/api/network/push --data "${PUSH_FORMAT}"
```

#### 4.2. PUT Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:44:59 GMT
Content-Length: 43
```

```json
{"result":"success: broadcast","return":1}
```

### 5. /api/node/pubkey

#### 5.1. GET Request

```bash
curl -i -X GET -H 'Accept: application/json' http://localhost:7572/api/node/pubkey
```

#### 5.1. GET Response

```
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 12 Oct 2022 09:24:16 GMT
Content-Length: 1095
```

```json
{"result":"Pub(go-peer/rsa){3082020A0282020100C71D5265F2CF14041E3E966B13E652ED8A87913E6907FB16FCE698F876B5AE7544FB337FB246DD20FEEFDFAE823476F1B6CC01A0F5C25D3F7A0FD17BAF2EF4193883FB55E6945B51FC6E17B625391F99EAE223FB4992BA5FE83C000BC44FEF67F78A33A7BDB1891E16EBDF6C0C161709242B5EF275E9B0DACDC5FA6BF7884C942FB9A2B8C4C04265DD209306DE805D5232A68D4E2B124699BB37C19C1EB493938E5CED4E717AD030440337423E306C80AA9AE6F5B63D03D5EC6B7F708E9CE6B3716820A9B643D6F7C318F18CFB28AB20153A6AD43E81CC0BB9758670D9F592A3D9713565BC26767D8FAB3BC2D33847F34DD0BE1F3C53F4873C5153E761B7AE346CABB52A9692618D3AC7282C90B294A3129B91B40FE04CB481922EC3C6C31ED068A2654CD1ACFF5584515204ADCB84CB5ACD3DA07DCBCABE45BD4CBC3D55FE41FF9FAB41ECF948E43C1FE9A8253CD1AEE30900216C0A78ED0AB3C2DEB0852003C5155C57C5847374248430A8D462908B0B5E5E03AD597C44EB4ECDE82B1B62DA29A0792E890F6B6CE1672285C8D5D16DC8E0DF3D0B6110A9CC7D1BCF63E6B83C4E976A088DDDACC7FD711F95F568D4E8ED96D3E17C9E48DCA363D6F024507E423326936090E3A4B9865DF6AB577BC4EC45CC8C9BA4E80E9B9D8BF3A6C796555582016148C8C2D85FBD5284E1013F7451FC52ABF70942CB7D7DE8F75D97522FA50203010001}","return":1}
```
